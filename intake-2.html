<!DOCTYPE html>
<html lang="en" data-lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sensis • Paper Layout</title>
  <link href="https://fonts.googleapis.com/css2?family=Oleo+Script+Swash+Caps&family=Lora&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=2">
  <link rel="stylesheet" href="css/paperV2.css?v=2">
  <style>
    .result-card{margin-top:12px;padding:12px;border-radius:8px}
    .result-card.ok{background:#eefbf1;border:1px solid #9be0af}
    .result-card.err{background:#fff2f2;border:1px solid #ffb3b3}
    .actions{display:flex;gap:.75rem;margin-top:12px}
    .actions .primary{font-weight:600}
    
    /* 强制修复表单样式 */
    .paperv1 .md .options {
      display: grid !important;
      gap: 6px 16px !important;
      align-items: start !important;
    }
    .paperv1 .md .options.cols-2 { 
      grid-template-columns: repeat(2, minmax(0,1fr)) !important; 
    }
    .paperv1 .md .options.cols-3 { 
      grid-template-columns: repeat(3, minmax(0,1fr)) !important; 
    }
    .paperv1 .md .options > label { 
      display: flex !important; 
      align-items: center !important;
      padding: .2em .1em !important; 
      border-radius: 6px !important; 
      margin: 0 !important;
    }
    .paperv1 .md input[type="radio"], 
    .paperv1 .md input[type="checkbox"] {
      width: 18px !important; 
      height: 18px !important; 
      margin: 0 .6em 0 0 !important; 
      accent-color: var(--md-accent) !important;
      flex-shrink: 0 !important;
    }
    
    /* 修复多语言文本显示 */
    .i18n[lang] { 
      display: none !important; 
    }
    html[data-lang="en"] .i18n[lang="en"] { 
      display: inline !important; 
    }
    html[data-lang="cn"] .i18n[lang="cn"] { 
      display: inline !important; 
    }
    html[data-lang="jp"] .i18n[lang="jp"] { 
      display: inline !important; 
    }
    
    /* 确保label内的多语言文本不影响布局 */
    .paperv1 .md .options > label .i18n {
      display: inline !important;
    }
    .paperv1 .md .options > label .i18n[lang]:not([lang="en"]) {
      display: none !important;
    }
    html[data-lang="cn"] .paperv1 .md .options > label .i18n[lang="cn"] {
      display: inline !important;
    }
    html[data-lang="jp"] .paperv1 .md .options > label .i18n[lang="jp"] {
      display: inline !important;
    }
    
    /* 手机单列显示 */
    @media (max-width: 760px) { 
      .paperv1 .md .options { 
        grid-template-columns: 1fr !important; 
      } 
    }
    
    /* 修复Section标题样式 */
    .paperv1 .md h2 {
      color: #007cba !important;
      border-bottom: 2px solid #007cba !important;
      padding-bottom: 0.5rem !important;
      margin: 2rem 0 1rem 0 !important;
    }
    
    /* 修复字段标题 */
    .paperv1 .md .field > div strong,
    .paperv1 .md .field > label strong {
      display: block !important;
      margin-bottom: 0.5rem !important;
      font-weight: 600 !important;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <aside>
      <div class="brand">
        <a href="index.html" class="logo-link">
          <img src="assets/sensis-logo.png" alt="Sensis logo">
        </a>
      </div>
      <nav>
        <a href="question.html"><span>Question</span></a>
        <a href="search.html"><span>Search</span></a>
        <a href="learn.html"><span>Learn</span></a>
        <a href="create.html"><span>Create</span></a>
      </nav>
    </aside>

    <main>
      <div class="langs">
        <button class="lang is-active" data-lang="en">English</button>
        <button class="lang" data-lang="cn">中 文</button>
        <button class="lang" data-lang="jp">日本語</button>
      </div>

      <article class="paperv1">
        <header class="paperv1-header" aria-label="paper header">
          <img class="paperv1-art desktop" src="assets/paper-2.png" alt="Header art (desktop)">
          <img class="paperv1-art -mobile" src="assets/paper-3.png" alt="Header art (mobile)">
          <h1 class="paperv1-title">
            <span class="i18n" lang="en">Open The Perception Path</span>
            <span class="i18n" lang="cn">开启感知之路</span>
            <span class="i18n" lang="jp">知覚の道を開く</span>
          </h1>
          <h2 class="paperv1-sub">
            <span class="i18n" lang="en">Let Sensis help you perceive yourself </span>
            <span class="i18n" lang="cn">让 Sensis 帮助你感知自己</span>
            <span class="i18n" lang="jp">Sensisがあなた自身を知覚し</span>
            <br>
            <span class="i18n" lang="en">and achieve your goals faster </span>
            <span class="i18n" lang="cn">更快地实现目标 </span>
            <span class="i18n" lang="jp">目標をより早く達成することを支援します </span>
          </h2>
        </header>

        <section class="paperv1-body" id="content">
          <div class="md">
            <header class="md-head">
              <h1 class="md-title">
                <span class="i18n" lang="en">User Basic Information</span>
                <span class="i18n" lang="cn">用户基础信息</span>
                <span class="i18n" lang="jp">基本情報</span>
              </h1>
              <p class="md-sub">
                <span class="i18n" lang="en">Please answer the questions below. Use ○ for single choice and □ for multiple choice.</span>
                <span class="i18n" lang="cn">请回答以下问题。单选用 ○，多选用 □。</span>
                <span class="i18n" lang="jp">以下の質問にお答えください。単一選択は○、複数選択は□です。</span>
              </p>
            </header>

            <form id="intake">
              <!-- Nick Name -->
              <div class="field">
                <label><strong>
                  <span class="i18n" lang="en">Nick Name</span>
                  <span class="i18n" lang="cn">昵称</span>
                  <span class="i18n" lang="jp">ニックネーム</span>
                </strong></label>
                <input type="text" name="user_nick" placeholder="">
              </div>

              <!-- === Section A === -->
              <h2>
                <span class="i18n" lang="en">Section A: System (Institutions and Structures)</span>
                <span class="i18n" lang="cn">A 部分：系统（制度与结构）</span>
                <span class="i18n" lang="jp">A セクション：制度・構造</span>
              </h2>

              <!-- A1 年龄 -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">A1. Your age group</span>
                  <span class="i18n" lang="cn">A1. 年龄段</span>
                  <span class="i18n" lang="jp">A1. 年齢層</span>
                </strong></div>
                <div class="options cols-2">
                  <label><input type="radio" name="age" value="Under 18"><span class="i18n" lang="en">Under 18</span><span class="i18n" lang="cn">18岁以下</span><span class="i18n" lang="jp">18歳未満</span></label>
                  <label><input type="radio" name="age" value="18-24"><span class="i18n" lang="en">18–24</span><span class="i18n" lang="cn">18–24</span><span class="i18n" lang="jp">18–24</span></label>
                  <label><input type="radio" name="age" value="25-34"><span class="i18n" lang="en">25–34</span><span class="i18n" lang="cn">25–34</span><span class="i18n" lang="jp">25–34</span></label>
                  <label><input type="radio" name="age" value="35-44"><span class="i18n" lang="en">35–44</span><span class="i18n" lang="cn">35–44</span><span class="i18n" lang="jp">35–44</span></label>
                  <label><input type="radio" name="age" value="45+"><span class="i18n" lang="en">45+</span><span class="i18n" lang="cn">45+</span><span class="i18n" lang="jp">45歳以上</span></label>
                </div>
              </div>

              <!-- A2 学历 -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">A2. Highest level of education</span>
                  <span class="i18n" lang="cn">A2. 最高学历</span>
                  <span class="i18n" lang="jp">A2.最終学歴</span>
                </strong></div>
                <div class="options cols-2">
                  <label><input type="radio" name="edu" value="High School or below"><span class="i18n" lang="en">High school or below</span><span class="i18n" lang="cn">高中及以下</span><span class="i18n" lang="jp">高校卒以下</span></label>
                  <label><input type="radio" name="edu" value="Associate"><span class="i18n" lang="en">Associate</span><span class="i18n" lang="cn">大专/技校</span><span class="i18n" lang="jp">準学士/専門学校</span></label>
                  <label><input type="radio" name="edu" value="Bachelor"><span class="i18n" lang="en">Bachelor</span><span class="i18n" lang="cn">本科</span><span class="i18n" lang="jp">学士</span></label>
                  <label><input type="radio" name="edu" value="Master"><span class="i18n" lang="en">Master</span><span class="i18n" lang="cn">硕士</span><span class="i18n" lang="jp">修士</span></label>
                  <label><input type="radio" name="edu" value="Doctorate"><span class="i18n" lang="en">Doctorate</span><span class="i18n" lang="cn">博士</span><span class="i18n" lang="jp">博士</span></label>
                </div>
              </div>

              <!-- A3 职业 -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">A3. Occupation</span>
                  <span class="i18n" lang="cn">A3. 职业</span>
                  <span class="i18n" lang="jp">A3. 職業</span>
                </strong></div>
                <div class="options cols-2">
                  <label><input type="radio" name="occupation" value="Student"><span class="i18n" lang="en">Student</span><span class="i18n" lang="cn">学生</span><span class="i18n" lang="jp">学生</span></label>
                  <label><input type="radio" name="occupation" value="Employee"><span class="i18n" lang="en">Employee</span><span class="i18n" lang="cn">受雇者</span><span class="i18n" lang="jp">会社員</span></label>
                  <label><input type="radio" name="occupation" value="Self-employed"><span class="i18n" lang="en">Self-employed</span><span class="i18n" lang="cn">自雇人士</span><span class="i18n" lang="jp">自営業</span></label>
                  <label><input type="radio" name="occupation" value="Gap Year"><span class="i18n" lang="en">Gap Year</span><span class="i18n" lang="cn">空档期</span><span class="i18n" lang="jp">ギャップイヤー</span></label>
                </div>
              </div>

              <!-- A4 专业 + Other 输入 -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">A4. Major</span>
                  <span class="i18n" lang="cn">A4. 专业</span>
                  <span class="i18n" lang="jp">A4. 専攻</span>
                </strong></div>
                <div class="options cols-3" id="major-group">
                  <label><input type="radio" name="major" value="Agriculture"><span class="i18n" lang="en">Agriculture</span><span class="i18n" lang="cn">农业</span><span class="i18n" lang="jp">農学</span></label>
                  <label><input type="radio" name="major" value="Art"><span class="i18n" lang="en">Art</span><span class="i18n" lang="cn">艺术</span><span class="i18n" lang="jp">芸術</span></label>
                  <label><input type="radio" name="major" value="Economics"><span class="i18n" lang="en">Economics</span><span class="i18n" lang="cn">经济学</span><span class="i18n" lang="jp">経済学</span></label>
                  <label><input type="radio" name="major" value="Education"><span class="i18n" lang="en">Education</span><span class="i18n" lang="cn">教育学</span><span class="i18n" lang="jp">教育学</span></label>
                  <label><input type="radio" name="major" value="Engineering"><span class="i18n" lang="en">Engineering</span><span class="i18n" lang="cn">工学</span><span class="i18n" lang="jp">工学</span></label>
                  <label><input type="radio" name="major" value="History"><span class="i18n" lang="en">History</span><span class="i18n" lang="cn">历史学</span><span class="i18n" lang="jp">歴史学</span></label>
                  <label><input type="radio" name="major" value="Journalism and Communication"><span class="i18n" lang="en">Journalism & Communication</span><span class="i18n" lang="cn">新闻传播</span><span class="i18n" lang="jp">新聞・メディア</span></label>
                  <label><input type="radio" name="major" value="Law"><span class="i18n" lang="en">Law</span><span class="i18n" lang="cn">法学</span><span class="i18n" lang="jp">法学</span></label>
                  <label><input type="radio" name="major" value="Literature"><span class="i18n" lang="en">Literature</span><span class="i18n" lang="cn">文学</span><span class="i18n" lang="jp">文学</span></label>
                  <label><input type="radio" name="major" value="Literature-language"><span class="i18n" lang="en">Language & Literature</span><span class="i18n" lang="cn">语言文学</span><span class="i18n" lang="jp">言語・文学</span></label>
                  <label><input type="radio" name="major" value="Management"><span class="i18n" lang="en">Management</span><span class="i18n" lang="cn">管理学</span><span class="i18n" lang="jp">経営学</span></label>
                  <label><input type="radio" name="major" value="Medicine"><span class="i18n" lang="en">Medicine</span><span class="i18n" lang="cn">医学</span><span class="i18n" lang="jp">医学</span></label>
                  <label><input type="radio" name="major" value="Philosophy"><span class="i18n" lang="en">Philosophy</span><span class="i18n" lang="cn">哲学</span><span class="i18n" lang="jp">哲学</span></label>
                  <label><input type="radio" name="major" value="Science"><span class="i18n" lang="en">Science</span><span class="i18n" lang="cn">理学</span><span class="i18n" lang="jp">理学</span></label>
                  <label><input type="radio" name="major" value="Sociology"><span class="i18n" lang="en">Sociology</span><span class="i18n" lang="cn">社会学</span><span class="i18n" lang="jp">社会学</span></label>
                  <label><input type="radio" name="major" value="Other" id="major-other-radio"><span class="i18n" lang="en">Other</span><span class="i18n" lang="cn">其他</span><span class="i18n" lang="jp">その他</span></label>
                </div>
                <div id="major-other-wrap" style="margin-top:.5rem; display:none;">
                  <input type="text" name="major_other" id="major-other-input" placeholder="If Other, please specify">
                </div>
              </div>

              <!-- A5 语言资格（多选） -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">A5. Language qualifications obtained/pending</span>
                  <span class="i18n" lang="cn">A5. 已获或待考的语言资格</span>
                  <span class="i18n" lang="jp">A5. 取得済み／予定の語学資格</span>
                </strong></div>
                <div class="options cols-3">
                  <label><input type="checkbox" name="lang_qual[]" value="IELTS-5">IELTS-5</label>
                  <label><input type="checkbox" name="lang_qual[]" value="IELTS-6">IELTS-6</label>
                  <label><input type="checkbox" name="lang_qual[]" value="IELTS-7">IELTS-7</label>
                  <label><input type="checkbox" name="lang_qual[]" value="IELTS-8">IELTS-8</label>
                  <label><input type="checkbox" name="lang_qual[]" value="JLPT-N1">JLPT-N1</label>
                  <label><input type="checkbox" name="lang_qual[]" value="JLPT-N2">JLPT-N2</label>
                  <label><input type="checkbox" name="lang_qual[]" value="JLPT-N3">JLPT-N3</label>
                  <label><input type="checkbox" name="lang_qual[]" value="JLPT-N4">JLPT-N4</label>
                  <label><input type="checkbox" name="lang_qual[]" value="JLPT-N5">JLPT-N5</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEFL-50">TOEFL-50</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEFL-60">TOEFL-60</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEFL-70">TOEFL-70</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEFL-80">TOEFL-80</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEFL-90">TOEFL-90</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEFL-90+">TOEFL-90+</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEIC-500">TOEIC-500</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEIC-600">TOEIC-600</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEIC-700">TOEIC-700</label>
                  <label><input type="checkbox" name="lang_qual[]" value="TOEIC-800">TOEIC-800</label>
                </div>
              </div>

              <!-- A6 时间状态 -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">A6. Time status</span>
                  <span class="i18n" lang="cn">A6. 时间状态</span>
                  <span class="i18n" lang="jp">A6. 時間の状況</span>
                </strong></div>
                <label><input type="radio" name="time_status" value="Full-time preparation">Full-time preparation</label>
                <label><input type="radio" name="time_status" value="Current student">Current student</label>
                <label><input type="radio" name="time_status" value="Part-time preparation">Part-time preparation</label>
                <label><input type="radio" name="time_status" value="Fragmented time">Fragmented time</label>
              </div>

              <!-- ===== Section B ===== -->
              <h2>
                <span class="i18n" lang="en">Section B: Personal</span>
                <span class="i18n" lang="cn">B 部分：个人</span>
                <span class="i18n" lang="jp">B セクション：個人</span>
              </h2>

              <!-- B1 兴趣（多选） -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">B1. Your interests</span>
                  <span class="i18n" lang="cn">B1. 你的兴趣</span>
                  <span class="i18n" lang="jp">B1. あなたの興味</span>
                </strong></div>
                <div class="options cols-3">
                  <label><input type="checkbox" name="interests[]" value="academic-research"><span class="i18n" lang="en">Academic research</span><span class="i18n" lang="cn">学术研究</span><span class="i18n" lang="jp">学術研究</span></label>
                  <label><input type="checkbox" name="interests[]" value="creative-writing"><span class="i18n" lang="en">Creative writing</span><span class="i18n" lang="cn">创意写作</span><span class="i18n" lang="jp">創作活動</span></label>
                  <label><input type="checkbox" name="interests[]" value="design"><span class="i18n" lang="en">Design</span><span class="i18n" lang="cn">设计</span><span class="i18n" lang="jp">デザイン</span></label>
                  <label><input type="checkbox" name="interests[]" value="languages"><span class="i18n" lang="en">Languages</span><span class="i18n" lang="cn">语言</span><span class="i18n" lang="jp">言語</span></label>
                  <label><input type="checkbox" name="interests[]" value="business"><span class="i18n" lang="en">Business</span><span class="i18n" lang="cn">商业</span><span class="i18n" lang="jp">ビジネス</span></label>
                  <label><input type="checkbox" name="interests[]" value="humanities"><span class="i18n" lang="en">Humanities</span><span class="i18n" lang="cn">人文学科</span><span class="i18n" lang="jp">人文学</span></label>
                  <label><input type="checkbox" name="interests[]" value="social-science"><span class="i18n" lang="en">Social science</span><span class="i18n" lang="cn">社会科学</span><span class="i18n" lang="jp">社会科学</span></label>
                  <label><input type="checkbox" name="interests[]" value="arts-culture"><span class="i18n" lang="en">Arts & culture</span><span class="i18n" lang="cn">艺术文化</span><span class="i18n" lang="jp">芸術・文化</span></label>
                  <label><input type="checkbox" name="interests[]" value="anime-comics"><span class="i18n" lang="en">Anime and comics</span><span class="i18n" lang="cn">动漫</span><span class="i18n" lang="jp">アニメ・漫画</span></label>
                  <label><input type="checkbox" name="interests[]" value="reading-novels"><span class="i18n" lang="en">Reading novels</span><span class="i18n" lang="cn">小说阅读</span><span class="i18n" lang="jp">小説読書</span></label>
                  <label><input type="checkbox" name="interests[]" value="philosophy"><span class="i18n" lang="en">Philosophical thinking</span><span class="i18n" lang="cn">哲学思考</span><span class="i18n" lang="jp">哲学的思考</span></label>
                  <label><input type="checkbox" name="interests[]" value="history"><span class="i18n" lang="en">Historical stories</span><span class="i18n" lang="cn">历史故事</span><span class="i18n" lang="jp">歴史物語</span></label>
                  <label><input type="checkbox" name="interests[]" value="social-issues"><span class="i18n" lang="en">Social issues</span><span class="i18n" lang="cn">社会问题</span><span class="i18n" lang="jp">社会問題</span></label>
                  <label><input type="checkbox" name="interests[]" value="psychology"><span class="i18n" lang="en">Psychological testing</span><span class="i18n" lang="cn">心理测试</span><span class="i18n" lang="jp">心理テスト</span></label>
                  <label><input type="checkbox" name="interests[]" value="economics"><span class="i18n" lang="en">Economic observation</span><span class="i18n" lang="cn">经济观察</span><span class="i18n" lang="jp">経済観察</span></label>
                  <label><input type="checkbox" name="interests[]" value="documentaries"><span class="i18n" lang="en">Watching documentaries</span><span class="i18n" lang="cn">看纪录片</span><span class="i18n" lang="jp">ドキュメンタリー鑑賞</span></label>
                  <label><input type="checkbox" name="interests[]" value="sci-fi"><span class="i18n" lang="en">Science fiction settings</span><span class="i18n" lang="cn">科幻设定</span><span class="i18n" lang="jp">SF設定</span></label>
                  <label><input type="checkbox" name="interests[]" value="writing"><span class="i18n" lang="en">Writing</span><span class="i18n" lang="cn">写作</span><span class="i18n" lang="jp">執筆</span></label>
                  <label><input type="checkbox" name="interests[]" value="programming"><span class="i18n" lang="en">Programming</span><span class="i18n" lang="cn">编程</span><span class="i18n" lang="jp">プログラミング</span></label>
                  <label><input type="checkbox" name="interests[]" value="gaming"><span class="i18n" lang="en">Gaming</span><span class="i18n" lang="cn">游戏</span><span class="i18n" lang="jp">ゲーム</span></label>
                  <label><input type="checkbox" name="interests[]" value="social-behavior"><span class="i18n" lang="en">Observing social behavior</span><span class="i18n" lang="cn">观察社会行为</span><span class="i18n" lang="jp">社会行動観察</span></label>
                  <label><input type="checkbox" name="interests[]" value="environment"><span class="i18n" lang="en">Environmental issues</span><span class="i18n" lang="cn">环境问题</span><span class="i18n" lang="jp">環境問題</span></label>
                  <label><input type="checkbox" name="interests[]" value="womens-equality"><span class="i18n" lang="en">Women's equality</span><span class="i18n" lang="cn">女性平等</span><span class="i18n" lang="jp">女性平等</span></label>
                  <label><input type="checkbox" name="interests[]" value="dramas-variety"><span class="i18n" lang="en">Dramas and variety shows</span><span class="i18n" lang="cn">电视剧综艺</span><span class="i18n" lang="jp">ドラマ・バラエティ</span></label>
                  <label><input type="checkbox" name="interests[]" value="food"><span class="i18n" lang="en">Food</span><span class="i18n" lang="cn">美食</span><span class="i18n" lang="jp">グルメ</span></label>
                  <label><input type="checkbox" name="interests[]" value="fitness"><span class="i18n" lang="en">Exercise and fitness</span><span class="i18n" lang="cn">运动健身</span><span class="i18n" lang="jp">運動・フィットネス</span></label>
                  <label><input type="checkbox" name="interests[]" value="extreme-sports"><span class="i18n" lang="en">Extreme sports</span><span class="i18n" lang="cn">极限运动</span><span class="i18n" lang="jp">エクストリームスポーツ</span></label>
                  <label><input type="checkbox" name="interests[]" value="music"><span class="i18n" lang="en">Music and musical instruments</span><span class="i18n" lang="cn">音乐乐器</span><span class="i18n" lang="jp">音楽・楽器</span></label>
                  <label><input type="checkbox" name="interests[]" value="photography"><span class="i18n" lang="en">Photography</span><span class="i18n" lang="cn">摄影</span><span class="i18n" lang="jp">写真</span></label>
                  <label><input type="checkbox" name="interests[]" value="sightseeing"><span class="i18n" lang="en">Sightseeing</span><span class="i18n" lang="cn">观光</span><span class="i18n" lang="jp">観光</span></label>
                  <label><input type="checkbox" name="interests[]" value="social-media"><span class="i18n" lang="en">Social media</span><span class="i18n" lang="cn">社交媒体</span><span class="i18n" lang="jp">ソーシャルメディア</span></label>
                </div>
              </div>

              <!-- B2 目标（多选） -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">B2. Your current goals</span>
                  <span class="i18n" lang="cn">B2. 你的当前目标</span>
                  <span class="i18n" lang="jp">B2. 現在の目標</span>
                </strong></div>
                <div class="options cols-2">
                  <label><input type="checkbox" name="goals[]" value="further-studies"><span class="i18n" lang="en">Further studies</span><span class="i18n" lang="cn">深造学习</span><span class="i18n" lang="jp">さらなる学習</span></label>
                  <label><input type="checkbox" name="goals[]" value="admission"><span class="i18n" lang="en">Graduate/college admission (domestic)</span><span class="i18n" lang="cn">研究生/大学入学（国内）</span><span class="i18n" lang="jp">大学院・大学入学（国内）</span></label>
                  <label><input type="checkbox" name="goals[]" value="study-abroad"><span class="i18n" lang="en">Studying abroad</span><span class="i18n" lang="cn">出国留学</span><span class="i18n" lang="jp">海外留学</span></label>
                  <label><input type="checkbox" name="goals[]" value="certification"><span class="i18n" lang="en">Certification / language exams</span><span class="i18n" lang="cn">资格证书/语言考试</span><span class="i18n" lang="jp">資格・語学試験</span></label>
                  <label><input type="checkbox" name="goals[]" value="change-major"><span class="i18n" lang="en">Changing majors</span><span class="i18n" lang="cn">转专业</span><span class="i18n" lang="jp">専攻変更</span></label>
                  <label><input type="checkbox" name="goals[]" value="postgraduate"><span class="i18n" lang="en">Postgraduate studies / preparatory courses</span><span class="i18n" lang="cn">研究生学习/预科课程</span><span class="i18n" lang="jp">大学院・予備課程</span></label>
                  <label><input type="checkbox" name="goals[]" value="doctoral"><span class="i18n" lang="en">Doctoral studies</span><span class="i18n" lang="cn">博士学习</span><span class="i18n" lang="jp">博士課程</span></label>
                  <label><input type="checkbox" name="goals[]" value="research-output"><span class="i18n" lang="en">Research output (paper, proposal)</span><span class="i18n" lang="cn">研究成果（论文、提案）</span><span class="i18n" lang="jp">研究成果（論文・提案）</span></label>
                  <label><input type="checkbox" name="goals[]" value="skills-building"><span class="i18n" lang="en">Skill building</span><span class="i18n" lang="cn">技能建设</span><span class="i18n" lang="jp">スキル構築</span></label>
                  <label><input type="checkbox" name="goals[]" value="portfolio"><span class="i18n" lang="en">Portfolio</span><span class="i18n" lang="cn">作品集</span><span class="i18n" lang="jp">ポートフォリオ</span></label>
                  <label><input type="checkbox" name="goals[]" value="self-realization"><span class="i18n" lang="en">Self-realization</span><span class="i18n" lang="cn">自我实现</span><span class="i18n" lang="jp">自己実現</span></label>
                </div>
              </div>

              <!-- B3 学习/工作习惯（单选） -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">B3. Study/work habit</span>
                  <span class="i18n" lang="cn">B3. 学习/工作习惯</span>
                  <span class="i18n" lang="jp">B3. 学習・仕事の習慣</span>
                </strong></div>
                <label><input type="radio" name="habit" value="short-sprints"><span class="i18n" lang="en">Short sprints, frequent breaks</span><span class="i18n" lang="cn">短时冲刺，频繁休息</span><span class="i18n" lang="jp">短時間集中・頻繁休憩</span></label>
                <label><input type="radio" name="habit" value="long-focus"><span class="i18n" lang="en">Long focus blocks</span><span class="i18n" lang="cn">长时间专注</span><span class="i18n" lang="jp">長時間集中</span></label>
                <label><input type="radio" name="habit" value="deadline-driven"><span class="i18n" lang="en">Deadline-driven</span><span class="i18n" lang="cn">截止日期驱动</span><span class="i18n" lang="jp">締切駆動型</span></label>
                <label><input type="radio" name="habit" value="regular-schedule"><span class="i18n" lang="en">Has a regular schedule</span><span class="i18n" lang="cn">有规律的时间表</span><span class="i18n" lang="jp">規則的なスケジュール</span></label>
                <label><input type="radio" name="habit" value="Deep thinking"><span class="i18n" lang="en">Deep thinking</span><span class="i18n" lang="cn">深度思考</span><span class="i18n" lang="jp">深い思考</span></label>
              </div>

              <!-- B4 任务偏好（多选） -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">B4. Task preferences</span>
                  <span class="i18n" lang="cn">B4. 任务偏好</span>
                  <span class="i18n" lang="jp">B4. タスクの好み</span>
                </strong></div>
                <div class="options cols-2">
                  <label><input type="checkbox" name="task_prefs[]" value="reading"><span class="i18n" lang="en">Reading & note-taking</span><span class="i18n" lang="cn">阅读记笔记</span><span class="i18n" lang="jp">読書・ノート取り</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="searching"><span class="i18n" lang="en">Searching & evaluating sources</span><span class="i18n" lang="cn">搜索评估资源</span><span class="i18n" lang="jp">情報検索・評価</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="writing"><span class="i18n" lang="en">Writing & editing</span><span class="i18n" lang="cn">写作编辑</span><span class="i18n" lang="jp">執筆・編集</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="practice"><span class="i18n" lang="en">Practice / problem-solving</span><span class="i18n" lang="cn">练习解题</span><span class="i18n" lang="jp">練習・問題解決</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="discussion"><span class="i18n" lang="en">Discussion / presentation</span><span class="i18n" lang="cn">讨论演示</span><span class="i18n" lang="jp">議論・発表</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="making"><span class="i18n" lang="en">Making / experiments</span><span class="i18n" lang="cn">制作实验</span><span class="i18n" lang="jp">制作・実験</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="companionship"><span class="i18n" lang="en">Needs companionship</span><span class="i18n" lang="cn">需要陪伴</span><span class="i18n" lang="jp">同伴が必要</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="independent"><span class="i18n" lang="en">Works independently</span><span class="i18n" lang="cn">独立工作</span><span class="i18n" lang="jp">独立作業</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="task-focused"><span class="i18n" lang="en">Task-focused</span><span class="i18n" lang="cn">任务专注</span><span class="i18n" lang="jp">タスク集中</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="trouble-concentrating"><span class="i18n" lang="en">Has trouble concentrating</span><span class="i18n" lang="cn">注意力困难</span><span class="i18n" lang="jp">集中困難</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="gives-up-easily"><span class="i18n" lang="en">Gives up easily</span><span class="i18n" lang="cn">容易放弃</span><span class="i18n" lang="jp">諦めやすい</span></label>
                  <label><input type="checkbox" name="task_prefs[]" value="strong-focus"><span class="i18n" lang="en">Strong focus</span><span class="i18n" lang="cn">专注力强</span><span class="i18n" lang="jp">集中力が強い</span></label>
                </div>
              </div>

              <!-- B5 障碍（多选） -->
              <div class="field">
                <div><strong>
                  <span class="i18n" lang="en">B5. Main obstacles (personal / psychological)</span>
                  <span class="i18n" lang="cn">B5. 主要障碍（个人/心理）</span>
                  <span class="i18n" lang="jp">B5. 主な障害（個人・心理）</span>
                </strong></div>
                <div class="options cols-2">
                  <label><input type="checkbox" name="obstacles[]" value="time"><span class="i18n" lang="en">Lack of time</span><span class="i18n" lang="cn">时间不足</span><span class="i18n" lang="jp">時間不足</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="methods"><span class="i18n" lang="en">Lack of methods</span><span class="i18n" lang="cn">方法不足</span><span class="i18n" lang="jp">方法不足</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="discipline"><span class="i18n" lang="en">Low discipline</span><span class="i18n" lang="cn">自律性低</span><span class="i18n" lang="jp">自制力不足</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="confidence"><span class="i18n" lang="en">Low confidence</span><span class="i18n" lang="cn">自信心不足</span><span class="i18n" lang="jp">自信不足</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="resources"><span class="i18n" lang="en">Lack of resources</span><span class="i18n" lang="cn">资源不足</span><span class="i18n" lang="jp">リソース不足</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="guidance"><span class="i18n" lang="en">Lack of guidance</span><span class="i18n" lang="cn">指导不足</span><span class="i18n" lang="jp">指導不足</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="procrastination"><span class="i18n" lang="en">Procrastination</span><span class="i18n" lang="cn">拖延症</span><span class="i18n" lang="jp">先延ばし</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="anxiety"><span class="i18n" lang="en">Anxiety</span><span class="i18n" lang="cn">焦虑</span><span class="i18n" lang="jp">不安</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="lack-planning"><span class="i18n" lang="en">Lack of planning</span><span class="i18n" lang="cn">缺乏规划</span><span class="i18n" lang="jp">計画不足</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="lack-motivation"><span class="i18n" lang="en">Lack of motivation</span><span class="i18n" lang="cn">缺乏动力</span><span class="i18n" lang="jp">動機不足</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="confusion"><span class="i18n" lang="en">Confusion</span><span class="i18n" lang="cn">困惑</span><span class="i18n" lang="jp">混乱</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="internal-friction"><span class="i18n" lang="en">Severe internal friction</span><span class="i18n" lang="cn">严重内耗</span><span class="i18n" lang="jp">深刻な内的摩擦</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="social-anxiety"><span class="i18n" lang="en">Social anxiety</span><span class="i18n" lang="cn">社交焦虑</span><span class="i18n" lang="jp">社交不安</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="loneliness"><span class="i18n" lang="en">Loneliness</span><span class="i18n" lang="cn">孤独感</span><span class="i18n" lang="jp">孤独感</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="poverty"><span class="i18n" lang="en">Poverty / financial stress</span><span class="i18n" lang="cn">贫困/经济压力</span><span class="i18n" lang="jp">貧困・経済的ストレス</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="depression"><span class="i18n" lang="en">Depression</span><span class="i18n" lang="cn">抑郁</span><span class="i18n" lang="jp">うつ</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="fragility"><span class="i18n" lang="en">Fragility / emotional sensitivity</span><span class="i18n" lang="cn">脆弱/情感敏感</span><span class="i18n" lang="jp">脆弱性・感情的敏感さ</span></label>
                  <label><input type="checkbox" name="obstacles[]" value="fear-mistakes"><span class="i18n" lang="en">Hate making mistakes</span><span class="i18n" lang="cn">害怕犯错</span><span class="i18n" lang="jp">ミスを恐れる</span></label>
                </div>
              </div></label>
                </div>
              </div>

              <!-- B3 学习/工作习惯（单选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">B3. Study/work habit</span></strong></div>
                <label><input type="radio" name="habit" value="short-sprints">Short sprints, frequent breaks</label>
                <label><input type="radio" name="habit" value="long-focus">Long focus blocks</label>
                <label><input type="radio" name="habit" value="deadline-driven">Deadline-driven</label>
                <label><input type="radio" name="habit" value="regular-schedule">Has a regular schedule</label>
                <label><input type="radio" name="habit" value="Deep thinking">Deep thinking</label>
              </div>

              <!-- B4 任务偏好（多选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">B4. Task preferences</span></strong></div>
                <div class="options cols-2">
                  <label><input type="checkbox" name="task_prefs[]" value="reading">Reading & note-taking</label>
                  <label><input type="checkbox" name="task_prefs[]" value="searching">Searching & evaluating sources</label>
                  <label><input type="checkbox" name="task_prefs[]" value="writing">Writing & editing</label>
                  <label><input type="checkbox" name="task_prefs[]" value="practice">Practice / problem-solving</label>
                  <label><input type="checkbox" name="task_prefs[]" value="discussion">Discussion / presentation</label>
                  <label><input type="checkbox" name="task_prefs[]" value="making">Making / experiments</label>
                  <label><input type="checkbox" name="task_prefs[]" value="companionship">Needs companionship</label>
                  <label><input type="checkbox" name="task_prefs[]" value="independent">Works independently</label>
                  <label><input type="checkbox" name="task_prefs[]" value="task-focused">Task-focused</label>
                  <label><input type="checkbox" name="task_prefs[]" value="trouble-concentrating">Has trouble concentrating</label>
                  <label><input type="checkbox" name="task_prefs[]" value="gives-up-easily">Gives up easily</label>
                  <label><input type="checkbox" name="task_prefs[]" value="strong-focus">Strong focus</label>
                </div>
              </div>

              <!-- B5 障碍（多选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">B5. Main obstacles (personal / psychological)</span></strong></div>
                <div class="options cols-2">
                  <label><input type="checkbox" name="obstacles[]" value="time">Lack of time</label>
                  <label><input type="checkbox" name="obstacles[]" value="methods">Lack of methods</label>
                  <label><input type="checkbox" name="obstacles[]" value="discipline">Low discipline</label>
                  <label><input type="checkbox" name="obstacles[]" value="confidence">Low confidence</label>
                  <label><input type="checkbox" name="obstacles[]" value="resources">Lack of resources</label>
                  <label><input type="checkbox" name="obstacles[]" value="guidance">Lack of guidance</label>
                  <label><input type="checkbox" name="obstacles[]" value="procrastination">Procrastination</label>
                  <label><input type="checkbox" name="obstacles[]" value="anxiety">Anxiety</label>
                  <label><input type="checkbox" name="obstacles[]" value="lack-planning">Lack of planning</label>
                  <label><input type="checkbox" name="obstacles[]" value="lack-motivation">Lack of motivation</label>
                  <label><input type="checkbox" name="obstacles[]" value="confusion">Confusion</label>
                  <label><input type="checkbox" name="obstacles[]" value="internal-friction">Severe internal friction</label>
                  <label><input type="checkbox" name="obstacles[]" value="social-anxiety">Social anxiety</label>
                  <label><input type="checkbox" name="obstacles[]" value="loneliness">Loneliness</label>
                  <label><input type="checkbox" name="obstacles[]" value="poverty">Poverty / financial stress</label>
                  <label><input type="checkbox" name="obstacles[]" value="depression">Depression</label>
                  <label><input type="checkbox" name="obstacles[]" value="fragility">Fragility / emotional sensitivity</label>
                  <label><input type="checkbox" name="obstacles[]" value="fear-mistakes">Hate making mistakes</label>
                </div>
              </div>

              <!-- B6 MBTI（单选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">B6. MBTI</span></strong></div>
                <div class="options cols-3">
                  <label><input type="radio" name="mbti" value="INTJ">INTJ</label>
                  <label><input type="radio" name="mbti" value="INTP">INTP</label>
                  <label><input type="radio" name="mbti" value="ENTJ">ENTJ</label>
                  <label><input type="radio" name="mbti" value="ENTP">ENTP</label>
                  <label><input type="radio" name="mbti" value="INFJ">INFJ</label>
                  <label><input type="radio" name="mbti" value="INFP">INFP</label>
                  <label><input type="radio" name="mbti" value="ENFJ">ENFJ</label>
                  <label><input type="radio" name="mbti" value="ENFP">ENFP</label>
                  <label><input type="radio" name="mbti" value="ISTJ">ISTJ</label>
                  <label><input type="radio" name="mbti" value="ISFJ">ISFJ</label>
                  <label><input type="radio" name="mbti" value="ESTJ">ESTJ</label>
                  <label><input type="radio" name="mbti" value="ESFJ">ESFJ</label>
                  <label><input type="radio" name="mbti" value="ISTP">ISTP</label>
                  <label><input type="radio" name="mbti" value="ISFP">ISFP</label>
                  <label><input type="radio" name="mbti" value="ESTP">ESTP</label>
                  <label><input type="radio" name="mbti" value="ESFP">ESFP</label>
                </div>
              </div>

              <!-- ===== Section C ===== -->
              <h2>
                <span class="i18n" lang="en">Section C: Situation</span>
                <span class="i18n" lang="cn">C 部分：情境</span>
                <span class="i18n" lang="jp">C セクション：状況</span>
              </h2>

              <!-- C1 每日可用时间（单选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">C1. Daily available time</span></strong></div>
                <label><input type="radio" name="daily_time" value="<30m">&lt; 30 min</label>
                <label><input type="radio" name="daily_time" value="30-60m">30–60 min</label>
                <label><input type="radio" name="daily_time" value="1-2h">1–2 hours</label>
                <label><input type="radio" name="daily_time" value="2-4h">2–4 hours</label>
                <label><input type="radio" name="daily_time" value=">4h">&gt; 4 hours</label>
              </div>

              <!-- C2 每周节奏（多选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">C2. Weekly pattern</span></strong></div>
                <label><input type="checkbox" name="weekly_pattern[]" value="weekday-nights">Weekday nights</label>
                <label><input type="checkbox" name="weekly_pattern[]" value="early-morning">Early morning</label>
                <label><input type="checkbox" name="weekly_pattern[]" value="weekends">Weekends</label>
                <label><input type="checkbox" name="weekly_pattern[]" value="distributed">Distributed small blocks</label>
              </div>

              <!-- C3 设备（多选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">C3. Devices you mainly use</span></strong></div>
                <label><input type="checkbox" name="devices[]" value="pc">PC / laptop</label>
                <label><input type="checkbox" name="devices[]" value="tablet">Tablet</label>
                <label><input type="checkbox" name="devices[]" value="phone">Phone</label>
                <label><input type="checkbox" name="devices[]" value="book/notebook">book/notebook</label>
              </div>

              <!-- C4 渠道（多选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">C4. Channels you prefer to receive help</span></strong></div>
                <div class="options cols-2">
                  <label><input type="checkbox" name="channels[]" value="chat">Chat / text</label>
                  <label><input type="checkbox" name="channels[]" value="email">Email</label>
                  <label><input type="checkbox" name="channels[]" value="video">Video calls</label>
                  <label><input type="checkbox" name="channels[]" value="templates">Templates / examples</label>
                  <label><input type="checkbox" name="channels[]" value="guides">Guides / step-by-step</label>
                  <label><input type="checkbox" name="channels[]" value="community">Community / peer support</label>
                </div>
              </div>

              <!-- C5 支持（多选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">C5. Support you have</span></strong></div>
                <div class="options cols-2">
                  <label><input type="checkbox" name="supports[]" value="mentor">Mentor / teacher</label>
                  <label><input type="checkbox" name="supports[]" value="friends">Friends / peers</label>
                  <label><input type="checkbox" name="supports[]" value="family">Family</label>
                  <label><input type="checkbox" name="supports[]" value="institution">Institution resources</label>
                </div>
              </div>

              <!-- C6 环境/生活方式（多选） -->
              <div class="field">
                <div><strong><span class="i18n" lang="en">C6. Environment / lifestyle</span></strong></div>
                <div class="options cols-2">
                  <label><input type="checkbox" name="env_life[]" value="quiet-space">Quiet study space</label>
                  <label><input type="checkbox" name="env_life[]" value="noisy">Noisy environment</label>
                  <label><input type="checkbox" name="env_life[]" value="commute">Commuting a lot</label>
                  <label><input type="checkbox" name="env_life[]" value="health-limits">Health limits</label>
                  <label><input type="checkbox" name="env_life[]" value="care-responsibility">Care responsibilities</label>
                  <label><input type="checkbox" name="env_life[]" value="late-night">Stays up late often</label>
                </div>
              </div>

              <!-- 备注字段 -->
              <div class="field">
                <label><strong>
                  <span class="i18n" lang="en">Additional Notes</span>
                  <span class="i18n" lang="cn">备注</span>
                  <span class="i18n" lang="jp">備考</span>
                </strong></label>
                <textarea name="notes" rows="3" placeholder="Any additional information... / 任何补充信息... / 追加情報..."></textarea>
              </div>

              <!-- 隐藏字段：语言（由JS自动填充） -->
              <input type="hidden" name="lang" id="lang-hidden">
            </form>

            <div class="actions">
              <button type="button" class="primary" onclick="exportJSON()">
                <span class="i18n" lang="en">Export JSON</span>
                <span class="i18n" lang="cn">导出 JSON</span>
                <span class="i18n" lang="jp">JSONを書き出す</span>
              </button>
              <button type="button" id="btn-submit" onclick="submitForm()" disabled>
                <span class="i18n" lang="en">Submit</span>
                <span class="i18n" lang="cn">提交</span>
                <span class="i18n" lang="jp">送信</span>
              </button>
              <button type="reset">
                <span class="i18n" lang="en">Reset</span>
                <span class="i18n" lang="cn">重置</span>
                <span class="i18n" lang="jp">リセット</span>
              </button>
            </div>

            <label class="consent">
              <input type="checkbox" id="consent">
              <span class="i18n" lang="en">I agree to data processing for Sensis research and product development.</span>
              <span class="i18n" lang="cn">我同意将数据用于 Sensis 的研究与产品开发。</span>
              <span class="i18n" lang="jp">本データの研究・製品開発への利用に同意します。</span>
            </label>

            <div id="feedback" class="result-card" hidden></div>
            <div id="out" class="out" aria-live="polite"></div>

            <hr>
          </div>
        </section>
      </article>
    </main>
  </div>

  <button class="fab-menu" aria-label="Open menu" aria-expanded="false">
    <img src="assets/menu-icon.png" alt="Menu">
  </button>
  <div class="backdrop" hidden></div>

  <script src="common.js" defer></script>

  <script>
  /** —— 表单 → JSON —— **/
  function formToJSON(form){
    // 提交前先更新隐藏的lang字段
    const langField = document.getElementById('lang-hidden');
    if (langField) {
      langField.value = getCurrentLang();
    }
    
    const fd = new FormData(form), out = {};
    for (const [k,v] of fd.entries()){
      if (k.endsWith('[]')) {
        (out[k.slice(0,-2)] ||= []).push(v);
      } else if (out[k] !== undefined) {
        out[k] = Array.isArray(out[k]) ? out[k].concat(v) : [out[k], v];
      } else {
        out[k] = v;
      }
    }
    
    // 确保lang字段存在（双重保险）
    if (!out.lang) {
      out.lang = getCurrentLang();
    }
    
    out.user_agent = navigator.userAgent || '';
    out.referer = location.href;
    return out;
  }

  /** —— 保证所有多选字段都有数组（没勾选也发 []） —— **/
  function normalizeArrays(data){
    const must = [
      'lang_qual','interests','goals','task_prefs','obstacles',
      'weekly_pattern','devices','channels','supports','env_life'
    ];
    for (const k of must) if (!Array.isArray(data[k])) data[k] = data[k] ? [data[k]] : [];
    return data;
  }

  function getCurrentLang(){
    const active = document.querySelector('.langs .lang.is-active');
    return active ? active.dataset.lang : (document.documentElement.dataset.lang || 'en');
  }

  function exportJSON(){
    const data = normalizeArrays(formToJSON(document.getElementById('intake')));
    document.getElementById('out').textContent = JSON.stringify(data, null, 2);
  }

  /** —— 你的 Apps Script 部署地址 —— **/
  const SHEETS_API = 'https://script.google.com/macros/s/AKfycbxmIG10CQYNsNeHA_3t7J9XsxgSLQfs1dK5fYPIkrTGEEM9Oky9tv0axp2Qh1A3WU1x/exec';

  /** —— 提交 —— **/
  async function submitForm(){
    const consent = document.getElementById('consent');
    const btn = document.getElementById('btn-submit');
    if (!consent.checked) { showFeedback('请先勾选同意数据处理。', false); return; }

    const formEl = document.getElementById('intake');
    const data = normalizeArrays(formToJSON(formEl));

    // 与后端一致：非 Other 清空 major_other，避免列偏移
    if (data.major !== 'Other') data.major_other = '';

    document.getElementById('out').textContent = JSON.stringify(data, null, 2);

    btn.disabled = true;
    btn.textContent = getTextByLang({ en:'Submitting…', cn:'提交中…', jp:'送信中…' });

    try {
      // 方案1：使用简单的fetch避免预检请求
      const res = await fetch(SHEETS_API, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify(data)
      });
      
      const responseText = await res.text();
      console.log('Raw response:', responseText);
      
      let json;
      try {
        json = JSON.parse(responseText);
      } catch {
        // 如果不是JSON，检查是否包含成功标识
        if (responseText.includes('ok') || res.ok) {
          json = { ok: true };
        } else {
          throw new Error('Invalid response: ' + responseText);
        }
      }
      
      if (!res.ok || json.ok === false) {
        throw new Error(json.error || 'HTTP ' + res.status);
      }
      
      showFeedback(getTextByLang({ 
        en:'Submitted successfully. Thank you.', 
        cn:'提交成功，感谢参与。', 
        jp:'送信完了。ありがとう。' 
      }), true);
      
    } catch (err) {
      console.error('Submit error:', err);
      showFeedback(getTextByLang({ 
        en:'Submission failed. Please try again or contact us.', 
        cn:'提交失败，请重试或联系维护者。', 
        jp:'送信に失敗。再試行するか連絡してくれ。' 
      }) + ' ' + String(err), false);
    } finally {
      btn.disabled = false;
      btn.textContent = getTextByLang({ en:'Submit', cn:'提交', jp:'送信' });
    }
  }

  /** —— A4: Other 输入框联动 —— **/
  (function majorOtherToggle(){
    const group = document.getElementById('major-group');
    const wrap  = document.getElementById('major-other-wrap');
    const ipt   = document.getElementById('major-other-input');
    if (!group || !wrap || !ipt) return;
    group.addEventListener('change', () => {
      const v = (group.querySelector('input[name="major"]:checked')||{}).value || '';
      const isOther = v === 'Other';
      wrap.style.display = isOther ? 'block' : 'none';
      if (!isOther) ipt.value = '';
    });
  })();

  /** —— 反馈卡 / 同意开关 —— **/
  function showFeedback(msg, ok){
    const el = document.getElementById('feedback');
    el.hidden = false;
    el.className = 'result-card ' + (ok ? 'ok' : 'err');
    el.textContent = msg;
  }
  function getTextByLang(map){
    const l = getCurrentLang();
    return map[l] || map.en || '';
  }
  (function initConsent(){
    const consent = document.getElementById('consent');
    const btn = document.getElementById('btn-submit');
    function sync(){ btn.disabled = !consent.checked; }
    if (consent) { consent.addEventListener('change', sync); sync(); }
  })();

  /** —— 监听语言切换，自动更新隐藏字段 —— **/
  function initLangFieldSync() {
    const langField = document.getElementById('lang-hidden');
    if (!langField) return;
    
    // 初始化
    langField.value = getCurrentLang();
    
    // 监听语言按钮点击
    document.querySelectorAll('.lang').forEach(btn => {
      btn.addEventListener('click', () => {
        setTimeout(() => {
          langField.value = getCurrentLang();
        }, 10);
      });
    });
  }

  // DOM加载完成后初始化
  document.addEventListener('DOMContentLoaded', function() {
    initLangFieldSync();
    
    // 语言切换事件监听
    document.querySelectorAll('.lang').forEach(btn => {
      btn.addEventListener('click', function() {
        const lang = this.dataset.lang;
        
        // 更新data-lang属性
        document.documentElement.setAttribute('data-lang', lang);
        
        // 更新按钮状态
        document.querySelectorAll('.lang').forEach(b => {
          b.classList.remove('is-active');
        });
        this.classList.add('is-active');
        
        // 更新隐藏字段
        const langField = document.getElementById('lang-hidden');
        if (langField) {
          langField.value = lang;
        }
      });
    });
    
    // 菜单切换事件监听
    const fabMenu = document.querySelector('.fab-menu');
    const backdrop = document.querySelector('.backdrop');
    
    function toggleMenu() {
      const body = document.body;
      if (body.classList.contains('drawer-open')) {
        body.classList.remove('drawer-open');
        if (fabMenu) fabMenu.setAttribute('aria-expanded', 'false');
        if (backdrop) backdrop.hidden = true;
      } else {
        body.classList.add('drawer-open');
        if (fabMenu) fabMenu.setAttribute('aria-expanded', 'true');
        if (backdrop) backdrop.hidden = false;
      }
    }
    
    if (fabMenu) fabMenu.addEventListener('click', toggleMenu);
    if (backdrop) backdrop.addEventListener('click', toggleMenu);
    
    // ESC关闭菜单
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.body.classList.remove('drawer-open');
        if (fabMenu) fabMenu.setAttribute('aria-expanded', 'false');
        if (backdrop) backdrop.hidden = true;
      }
    });
  });
  </script>
</body>
</html>
